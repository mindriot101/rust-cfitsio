{"version":1,"ops":[{"type":2,"author":{"id":"1e764343368ff219ef03863d19c5d4246a8b3728"},"timestamp":1499741908,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTE1Nzk4OTA1NQ=="},"title":"Invalid bitpix value from ffgiet causing panic","was":"Invalid bitpix value from ffgiet causing panic"},{"type":3,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1499757876,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxNDM1ODI1Nw==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-314358257"},"message":"Hi @saethlin, it looks like a value of 20 is `unsigned short` which must be being interpreted through the combination of `BSCALE` and `BZERO`. I have been pondering the use of `ffgiet` vs `ffgidt` for a little while, and perhaps need to switch to this function. I have not got time to look into it now, but hopefully a little later. thanks for reporting!","files":null},{"type":3,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1499794239,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxNDUxNjE3Mw==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-314516173"},"message":"So after playing around with this, there are two ways to solve the problem:\n\n1. change `ffgiet` to `ffgidt`\n2. include 20 =\u003e `ImageType::USHORT_IMG` in the list ([types.rs:57](https://github.com/mindriot101/rust-fitsio/blob/51a665c03c534d89c3f7524abc922841c28e54e2/fitsio/src/types.rs#L57))\n\nThe first solution changes from `fits_get_img_equivtype` to `fits_get_img_type` which seems better as it's first in the documentation, and generally that means the function should be preferred, but the description makes it sound like the second function is more true to what actually happens (e.g. with integer data and floating point `bscale` the type returned by `fits_get_img_equivtype` is a floating point type).\n\nIn addition, another `cfitsio` wrapper library [`fitsio`](https://github.com/esheldon/fitsio) uses `fits_get_img_equivtype` (see [`fitsio_pywrap.c:631`](https://github.com/esheldon/fitsio/blob/c71189e0ffe5f45cb584d83d1ab6a11ff86f4e80/fitsio/fitsio_pywrap.c#L631)).\n\nBased on a very unscientific test, searching `fits_get_img_equivtype` in github gives 482 results, whereas `fits_get_img_type` gives \u003e1k results.\n\n@saethlin do you have any insights?","files":null},{"type":3,"author":{"id":"1e764343368ff219ef03863d19c5d4246a8b3728"},"timestamp":1499805113,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxNDU2MjcwMA==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-314562700"},"message":"Mostly I'm bothered that cfitsio provides two ways to do the same task, but in general I lean towards `fits_get_img_type` because it's more explicit and doesn't return bitpix values that aren't valid for the BITPIX header field. Even if it's not what the cfitsio authors may hope for, I think `fgidt` is more maintainable.","files":null},{"type":4,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1499807736,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTE1OTYxMzU0NQ=="},"status":2},{"type":3,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1499808788,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxNDU3ODc1NQ==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-314578755"},"message":"I agree, the inconsistency in `cfitsio` is annoying, but we can help improve things by making the interface more intuitive. If the image data is floating point, stored as integers with `BSCALE/BZERO` appropriately, then the image data type presented to the user should be floating point.  We can achieve this with `fits_get_img_equivtype`. It also saves this crate from doing extra `BSCALE/BZERO` checking when we could just let `cfitsio` do it.","files":null},{"type":4,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1499808788,"metadata":{"github-id":"MDEzOlJlb3BlbmVkRXZlbnQxMTU5NjM4ODM2"},"status":1},{"type":3,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1499977747,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxNTE5Mjg0OQ==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-315192849"},"message":"@saethlin how do you feel about the changes I've made? Now `USHORT_IMG` data types are supported, and do not error, and I still feel `fits_get_img_equivtype` is my preferred choice.","files":null},{"type":3,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1507533896,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMzNTA4MjEwOA==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-335082108"},"message":"@saethlin have you had a chance to test the changes I've made?","files":null},{"type":3,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1508967466,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMzOTQ3OTUzMQ==","github-url":"https://github.com/mindriot101/rust-fitsio/issues/35#issuecomment-339479531"},"message":"My tests show this is not an issue any more, and your example file reads correctly. I'm closing this issue now. Thanks for your help and guidance!","files":null},{"type":4,"author":{"id":"b83e8b4dfca7ebd9aba65d02ac0e5e24f95b7802"},"timestamp":1508967467,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTMxMDgxMjEzMQ=="},"status":2}]}